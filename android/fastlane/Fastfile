default_platform(:android)

platform :android do
  desc "Gera o bundle de release"
  lane :build do
    gradle(
      task: "app:bundleRelease",
      project_dir: ".",
      flags: "--stacktrace"
    )
  end

  desc "Publica no Google Play usando o Gradle Play Publisher"
  lane :deploy do
    missing = %w[
      PLAY_SERVICE_ACCOUNT_JSON
      ANDROID_KEYSTORE_PATH
      ANDROID_KEYSTORE_PASSWORD
      ANDROID_KEY_ALIAS
      ANDROID_KEY_PASSWORD
    ].select { |key| ENV[key].to_s.empty? }

    UI.user_error!("Variáveis obrigatórias faltando: #{missing.join(', ')}") unless missing.empty?

    gradle(
      task: "app:publishReleaseBundle",
      project_dir: ".",
      flags: "--stacktrace"
    )
  end
end
